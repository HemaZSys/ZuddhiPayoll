@model First.Models.AttendanceReportHeader
@{
    ViewBag.Title = "AttendanceReport";
    List<First.Models.Emp> Employeelist = ViewBag.employees as List<First.Models.Emp>;
    //List<First.Models.LeaveReportHeader> leaveReportHeaderlist = ViewBag.leavedetails;    
}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="~/bower_components/font-awesome/css/font-awesome.min.css">

    <link rel="stylesheet" type="text/css" href="~/payslipreportJSCSS/CSS/1.13.2/css/jquery.dataTables.min.css">
    <link rel="stylesheet" type="text/css" href="~/payslipreportJSCSS/CSS/buttons/2.3.4/css/buttons.dataTables.min.css">
    <link rel="stylesheet" type="text/css" href="~/payslipreportJSCSS/CSS/select/1.6.0/css/select.dataTables.min.css">

    <script type="text/javascript" src="~/payslipreportJSCSS/JScript/jquery-3.5.1.js"></script>
    <script type="text/javascript" src="~/payslipreportJSCSS/JScript/1.13.2/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="~/payslipreportJSCSS/JScript/buttons/2.3.4/js/dataTables.buttons.min.js"></script>
    <script type="text/javascript" src="~/payslipreportJSCSS/JScript/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <script type="text/javascript" src="~/payslipreportJSCSS/JScript/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
    <script type="text/javascript" src="~/payslipreportJSCSS/JScript/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
    <script type="text/javascript" src="~/payslipreportJSCSS/JScript/buttons/2.3.4/js/buttons.html5.min.js"></script>
    <script type="text/javascript" src="~/payslipreportJSCSS/JScript/buttons/2.3.4/js/buttons.print.min.js"></script>
    <script type="text/javascript" src="~/payslipreportJSCSS/JScript/select/1.6.0/js/dataTables.select.min.js"></script>

    <script type="text/javascript">
        $(document).ready(function () {
            checkLogin();
            var options = $("#EmpName").html();
            options = "<option value='-2' selected>- Select All-</option>" + options;
            $("#EmpName").html(options);

            
            $('#tblAttendanceReport').DataTable({
                select: true
            });
           
            
            if (decrypt($("#userPrivilege").html()) == "Admin") {

                $('.clsUser').each(function (i, obj) {
                    $(this).hide();
                });
                $('.clsAdmin').each(function (i, obj) {
                    $(this).show();
                });
            }
            else {
                $('.clsUser').each(function (i, obj) {
                    $(this).show();
                });

                $('.clsAdmin').each(function (i, obj) {
                    $(this).hide();
                });
            }
           
           
           

            var tmpURL = document.location.href.split("/");
            tmpURL = tmpURL[tmpURL.length - 1];
            $("#EmpName").val(tmpURL);
           

            $("#EmpName").change(function () {
                var selectedValue = $(this).val();
                localStorage.setItem('myDropdownValue', selectedValue);
                
                var tmpURL = document.location.href;               
                tmpURL = tmpURL.split("AttendanceReport")[0]
                $("#datepicker").val()
                if ($("#datepicker").val() == "") {                   
                    $("#datepicker").val(DateTime.Now.ToString("yyyy - MM"));                    
                }
                $("#EmpName").val()
                if ($("#EmpName").val() == "") {
                    $("#EmpName").val() = -2;
                }               
                
                document.location.href = tmpURL + "AttendanceReport/" + $("#EmpName").val() + "?month=" + $("#datepicker").val();
                
            });

            
            var tmpURL = document.location.href.split("/");
            tmpURL = tmpURL[tmpURL.length - 1];
            $("#datepicker").val(tmpURL);


            $("#datepicker").change(function () {
                var selectedValue = $(this).val();
                localStorage.setItem('myDropdownValue1', selectedValue);
                var tmpURL = document.location.href;                
                tmpURL = tmpURL.split("AttendanceReport")[0]
                $("#EmpName").val()
                if ($("#EmpName").val() == "") {                   
                    $("#EmpName").val() = -2;                    
                }
                $("#datepicker").val()
                if ($("#datepicker").val() == "") {
                    $("#datepicker").val(DateTime.Now.ToString("yyyy - MM"));
                }               
                var nextMonth = new Date();
                nextMonth.setMonth(nextMonth.getMonth() + 1);             
                
                if ($("#datepicker").val() < nextMonth) {
                    // Current date and time is within the next month
                    alert("Please select current month or Previous Month!")
                }
                else {
                    // Current date and time is not within the next month
                    document.location.href = tmpURL + "AttendanceReport/" + $("#EmpName").val() + "?month=" + $("#datepicker").val();
                }
                              
            });
            
            var savedValue = localStorage.getItem('myDropdownValue');           
            if (savedValue) {
                $('#EmpName').val(savedValue);
            }
            var savedValue = localStorage.getItem('myDropdownValue1');            
            if (savedValue) {
                $('#datepicker').val(savedValue);
            }

        });
    </script>

    <style>

        table table-hover {
            width: 100%;
            border-collapse: collapse;
            border: 1px solid black;
        }

        .card-layout {
            box-shadow: 0 0 15px #322f2f37;
            padding: 0 1% 0 1% !important;
            background: #dbaaef30;
            margin: 0;
        }

        .container-fluid {
            padding-right: 0px !important;
            padding-left: 0px !important;
        }

        a {
            color: #8a15d3;
            text-decoration: none;
        }

        table td {
            line-height: 25px;
            padding-left: 15px;
            background-color: #fff !important;
            text-align: left;
        }

        table th {
            background-color: #340452;
            color: #fff;
            text-align: left;
        }

        .heading {
            text-align: center;
            font-size: 27px !important;
            font-weight: bold;
        }

        .registerbtn a, .registerbtn a:visited {
            color: #fff !important;
        }

        .registerbtn {
            float: right;
            height: 30px;
            border: none;
            border-radius: 0.65rem;
            padding: 1%;
            background: #340452;
            color: #fff;
            font-weight: 600;
            width: 100%;
            cursor: pointer;
        }

        * {
            box-sizing: border-box;
        }

        /* Clearfix (clear floats) */
        .row::after {
            content: "";
            clear: both;
            display: table;
        }
    </style>
</head>

<body>
    <div class="container-fluid">
        <div class="card card-layout">
            <div class="heading">Attendance Details Report</div>

            <div style="padding: 2%; overflow-x: scroll;">
                @*<button class="registerbtn" style="padding: 5px; color: red; background: #fff; width: 100px; float: right;" title="Export To Excel" id="btnExport">Export</button>*@

                <div class="col-lg-12 row">
                    <div class="col-lg-6">
                        <div class="row">
                            <div class="col-lg-6">
                                <p><b>Employee Name</b></p>
                            </div>
                            <div class="col-lg-6">
                                @*<p class="clsUser" style="display:none">@Html.DisplayFor(Model => Model.EmpName)</p>*@
                                <div>
                                    @Html.DropDownListFor(Model => Model.EmpName, new SelectList(Employeelist, "Id", "Name"))
                                </div>                                
                            </div>

                        </div>
                        <div class="row">
                            <div class="col-lg-6">
                                <p><b>Select Month</b></p>
                            </div>
                            <div class="col-lg-6">                               
                                @Html.TextBoxFor(Model => Model.MonthYear, new { type = "Month", name = "start", id = "datepicker", @class = "form-control" })
                               
                            </div>

                        </div>
                       
                    </div>
                    </div>

                        <table id="tblAttendanceReport" class="table table-hover" align="center">
                            <thead>
                                <tr>                                    
                                    <th style="text-align: center;" align="center">
                                        Employee ID
                                    </th>
                                    <th style="text-align: center;">
                                        Employee Name
                                    </th>
                                    <th style="text-align: center;">
                                        Date
                                    </th>
                                    <th style="text-align: center;">
                                        Login Time
                                    </th>
                                    <th style="text-align: center;">
                                        Logout Time
                                    </th>
                                    <th style="text-align: center;">
                                        Total Time
                                    </th>
                                    <th style="text-align: center;">
                                        Work Status
                                    </th>                                    
                                </tr>
                            </thead>
                            <tbody>
                                @*@if (Model.AttendanceReportList.Count() > 0)
                                {*@
                                    @for (int i = 0; i < Model.AttendanceReportList.Count(); i++)
                                    {                                       

                                <tr class="info">
                                    <td style="text-align:center;">
                                        @Html.HiddenFor(modelItem => Model.AttendanceReportList[i].id)
                                        @Html.DisplayFor(modelItem => Model.AttendanceReportList[i].EmployeeId)
                                    </td>
                                    <td style="text-align:center;">
                                        @Html.DisplayFor(modelItem => Model.AttendanceReportList[i].EmployeeName)
                                    </td>
                                    <td style="text-align:center;">
                                        @Html.DisplayFor(modelItem => Model.AttendanceReportList[i].shiftDate)
                                    </td>
                                    <td style="text-align:center;">
                                        @Html.DisplayFor(modelItem => Model.AttendanceReportList[i].LogInTime, "{0:hh\\:mm\\:tt}")
                                    </td>
                                    <td style="text-align:center;">
                                        @Html.DisplayFor(modelItem => Model.AttendanceReportList[i].LogOutTime)
                                    </td>
                                    <td style="text-align:center;">
                                        @Html.DisplayFor(modelItem => Model.AttendanceReportList[i].TotalTime)
                                    </td>
                                    @if (Model.AttendanceReportList[i].WorkStatus == "Present")
                                    {
                                        <td style="text-align: center; color: green; font-weight:bold">
                                            @Html.DisplayFor(modelItem => Model.AttendanceReportList[i].WorkStatus)
                                        </td>
                                    }
                                    else if (Model.AttendanceReportList[i].WorkStatus == "Leave")
                                    {
                                        <td style="text-align: center; color: cornflowerblue; font-weight:bold">
                                            @Html.DisplayFor(modelItem => Model.AttendanceReportList[i].WorkStatus)
                                        </td>
                                    }
                                    else
                                    {
                                        <td style="text-align: center; color: red; font-weight:bold">
                                            @Html.DisplayFor(modelItem => Model.AttendanceReportList[i].WorkStatus)
                                        </td>
                                    }
                                </tr>

                                    }
                                @*}
                                else
                                {
                                    <tr>
                                        <td colspan="8" style="text-align:center;">No Record Found</td>
                                    </tr>
                                }*@
                            </tbody>
                        </table>
                    </div>
                </div>
                <br />
            </div>
</body>
</html>
